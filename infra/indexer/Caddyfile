# Caddyfile for Autonomys Node
# This configuration sets up a reverse proxy for the node's RPC interface

# HTTP reverse proxy for RPC
:8000 {
    log {
        output stdout
        format console
        level INFO
    }

    # CORS headers
    header Access-Control-Allow-Origin *
    header Access-Control-Allow-Methods "GET, POST, OPTIONS"
    header Access-Control-Allow-Headers "Content-Type, Authorization"

    # Handle preflight requests
    @options method OPTIONS
    respond @options 200

    # Reverse proxy to the node
    # UPSTREAM_NODE can be set via environment variable (base URL without path)
    # For local: node:9944, for external: https://rpc.taurus.autonomys.xyz
    reverse_proxy {$UPSTREAM_NODE:node:9944} {
        header_up Host {upstream_hostport}
        header_up X-Real-IP {remote}
        header_up X-Forwarded-For {remote}
        header_up X-Forwarded-Proto {scheme}
    }
}
